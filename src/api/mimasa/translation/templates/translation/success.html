{% load static %}

<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <title>Mimasa - EmoteTrans</title>
  </head>
  <body style="background-color: #ADD8E6">
    <div class="container mt-5">
      <div class="row justify-content-center">
        <div class="col-md-8">
          <div class="card" style="background-color: #87CEFA">
            <div class="card-header">
              <img src="{% static 'mimasa-bg.png' %}" alt="Mimasa Logo" style="width:150px; height:150px;">
            </div>
            <div class="card-body">
              {% if mimasa.task_status != "SUCCESS" %}
                <h1 class="text-center">Translation Registered Successful</h1>
              {% else %}
                <h1 class="text-center">Translation Completed</h1>
                <hr>
                <p>Your video translation has completed successfully!</p>
                <a href="{{ mimasa.output_video_filename }}" class="btn btn-primary">View video</a><br>
                <p>Download the translated video by clicking the button below:</p>
                <a href="{{ mimasa.output_video_filename }}" class="btn btn-primary" download>Download Video</a>
                <br><br>
              {% endif %}
                <b>Status: {{ mimasa.task_status }}, id: {{ mimasa.task_id }} </b>
            </div>
          </div>
        </div>
      </div>
    </div>
  </body>
  <script>
    function checkTaskStatus() {
      $.ajax({
        url: "{% url 'get_task_status' task_id=mimasa.task_id %}",
        success: function(data) {
          if (data.task_status === "SUCCESS") {
            clearInterval(intervalId);
            console.log("Task completed");
          } else {
            console.log("Task not yet completed");
          }
        }
      });
    }

    var intervalId = setInterval(checkTaskStatus, 3000);
  </script>
</html>
